<!DOCTYPE html>
<html lang="{{ .Language.Lang }}">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		{{ with .Params.redirect }}{{ with .to }}
		<link rel="canonical" href="{{ . }}">
		<meta http-equiv="refresh" content="0; url={{ . }}">
		{{ end }}{{ end }}
		<meta name="viewport" content="width=device-width, initial-scale=1.0">

		<!-- ICON -->
		<link rel="icon" type="image/svg+xml" href="{{ "/assets/favicon.svg" | absURL }}" />
		<link rel="icon" type="image/png" href="{{ "/assets/favicon.png" | absURL }}" />

		<!-- PAGE TITLE AND DESCRIPTION -->
		{{ if .IsHome }}
			<title>{{ site.Title }}</title>
		{{ else if .Params.html_title }}
			<title>{{ .Params.html_title }} â€“ {{ site.Title }}</title>
		{{ else }}
			<title>{{ .Title }} â€“ {{ site.Title }}</title>
		{{ end }}
		{{ if .Description }}
		<meta name="description" content="{{ .Description | plainify | truncate 160 }}">
		{{ else }}
		<meta name="description" content="{{ site.Params.description }}">
		{{ end }}

		<!-- OPEN GRAPH -->
		<meta property="og:title" content="{{ if .Title }}{{ .Title }} â€“ {{ site.Title }}{{ else }}{{ site.Title }}{{ end }}">
		<meta property="og:description" content="{{ if .Description }}{{ .Description | plainify | truncate 160 }}{{ else }}{{ site.Params.description }}{{ end }}">
		<meta property="og:type" content="{{ if .Date }}article{{ else }}website{{ end }}">
		<meta property="og:url" content="{{ .Permalink }}">
		<meta property="og:site_name" content="{{ site.Title }}">
		<meta name="twitter:card" content="summary">

		<!-- FONT PRELOADS -->
		<link rel="preload" href="{{ "/assets/css/fonts/FiraSans-Light.woff2" | absURL }}" as="font" type="font/woff2" crossorigin>
		<link rel="preload" href="{{ "/assets/css/fonts/FiraMono-Regular.woff2" | absURL }}" as="font" type="font/woff2" crossorigin>

		<!-- CSS STYLESHEETS -->
		{{ $mainStyle := resources.Get "scss/main.scss" | toCSS (dict "targetPath" "assets/css/main.css") | minify }}
		<link rel="stylesheet" href="{{ $mainStyle.Permalink }}">

		<!-- FA -->
		<link rel="stylesheet" href="{{ "/assets/css/fa.min.css" | absURL }}">

		<!-- KATEX (server-side rendered, loaded conditionally) -->
		<link rel="stylesheet" href="{{ "/assets/css/katex.min.css" | absURL }}">

		<!-- CANONICAL -->
		<link rel="canonical" href="{{ .Permalink }}">

		{{ if site.Params.halloween }}
		<!-- HALLOWEEN: Hide Halloween toggle when JavaScript is disabled -->
		<noscript><style>.halloween-toggle { display: none; }</style></noscript>
		{{ end }}

		<!-- yoinked from Advent of Code: triple clicking a code snippet selects it in its entirety -->
		<script>window.addEventListener('click', function(e,s,r){if((e.target.nodeName==='PRE'||e.target.nodeName==='CODE')&&e.detail===3){s=window.getSelection();s.removeAllRanges();r=document.createRange();r.selectNodeContents(e.target);s.addRange(r);}});</script>

		{{ if site.Params.halloween }}
		<!-- HALLOWEEN: Halloween theme toggle -->
		<script src="{{ "/assets/js/halloween.js" | absURL }}" defer></script>
		{{ end }}

		{{ if .Params.htmx }}
		<meta name="htmx-config" content='{"selfRequestsOnly": false}' />
		<script src="{{ "/assets/js/htmx.min.js" | absURL }}" defer></script>
		{{ end }}
	</head>

	<body class="section-{{ .Section | default "root" }}">
		<a href="#main-content" class="skip-link">Skip to main content</a>
		{{ if site.Params.halloween }}
		<!-- HALLOWEEN: Cursor following ghost -->
		<div id="ghost-cursor" style="display: none; position: fixed; font-size: 60px; z-index: 9999; opacity: 0; transition: opacity 0.1s; left: 0; top: 0;" aria-hidden="true">
			<i class="fa-solid fa-ghost"></i>
			<div id="ghost-text" style="display: none; position: absolute; top: 85px; left: 50%; transform: translateX(-50%); white-space: nowrap; font-size: 12px; color: #fff; text-shadow: 0 0 3px rgba(0,0,0,0.8); font-family: Arial, sans-serif; pointer-events: none;">Got your cursor lmao</div>
		</div>
		{{ end }}
		<header class="header no-invert">
			{{ if site.Params.halloween }}
			<!-- HALLOWEEN: Cobweb decoration -->
			<img src="{{ "/assets/halloween/cobweb.svg" | absURL }}" style="display: none; position: absolute; top: 0; left: 0; width: 80px; height: auto; z-index: 1; opacity: 0.7;" alt="Cobweb">

			<h1><a href="/">{{ site.Title }}</a></h1>

			<!-- HALLOWEEN: Cobweb decoration (flipped) -->
			<img src="{{ "/assets/halloween/cobweb.svg" | absURL }}" style="display: none; position: absolute; bottom: 0; right: 0; width: 40px; height: auto; z-index: 1; opacity: 0.7; transform: scaleX(-1) scaleY(-1);" alt="Cobweb">
			{{ else }}
			<h1><a href="/">{{ site.Title }}</a></h1>
			{{ end }}
		</header>

		<!-- navigation bar -->
		<nav class="navigation-background" aria-label="Main navigation">
			<div class="navigation">
				<ul>
				{{- range site.Menus.main -}}
					<li>
					<span class="navbar-item">
					{{- $icon := .Params.icon -}}
					{{- $isCurrent := or ($.IsMenuCurrent "main" .) (eq $.RelPermalink .URL) -}}
					{{- if $isCurrent }}
						<span class="current-page-item navbar-text"><a href="{{ .URL }}">{{ with $icon }}<i class="{{ if strings.Contains . "fa-brands" }}{{ . }}{{ else }}fa-solid {{ . }}{{ end }}" aria-hidden="true"></i> {{ end }}{{ .Name }}</a></span>
					{{- else }}
						<span class="navbar-text"><a href="{{ .URL }}">{{ with $icon }}<i class="{{ if strings.Contains . "fa-brands" }}{{ . }}{{ else }}fa-solid {{ . }}{{ end }}" aria-hidden="true"></i> {{ end }}{{ .Name }}</a></span>
					{{- end }}
					</span>
					</li>
				{{- end -}}
				</ul>
			</div>
		</nav>

		<main id="main-content" class="content-background">

			<div class="content">
				{{ with .Params.redirect }}{{ with .to }}
				<div class='center'>
					<h2>Getting redirected...</h2>
					<a href="{{ . }}">Click here if you are not redirected.</a>
					<div class="spacer"></div>
				</div>
				{{ else }}
				{{ partial "page-heading.html" $ }}
				{{ end }}{{ else }}
				{{ partial "page-heading.html" $ }}
				{{ end }}

				{{ block "main" . }}{{ end }}
			</div>
		</main>

		<footer>
			<p>Maintained by <span id="author-name">TomÃ¡Å¡ SlÃ¡ma</span>.</p>
			<p class="large no-link-color">
				<a href="https://www.youtube.com/channel/UC_IaBSHmisYbiYlv32EeNkQ" rel="noopener noreferrer" aria-label="YouTube"><i class="fa-brands fa-youtube" aria-hidden="true"></i></a>
				<span class="tiny-vspace"></span>
				<a href="https://bsky.app/profile/tomas.slama.dev" rel="noopener noreferrer" aria-label="Bluesky"><i class="fa-brands fa-bluesky" aria-hidden="true"></i></a>
				<span class="tiny-vspace"></span>
				<a href="https://github.com/xiaoxiae" rel="noopener noreferrer" aria-label="GitHub"><i class="fa-brands fa-github" aria-hidden="true"></i></a>
				<span class="tiny-vspace"></span>
				<a href="https://open.spotify.com/playlist/6tzOl4stxMsAClqNaUalBg?si=466aa28329d143fd" rel="noopener noreferrer" aria-label="Spotify playlist"><i class="fa-brands fa-spotify" aria-hidden="true"></i></a>
				<span class="vspace"></span>
				<a href="mailto: tomas@slama.dev" aria-label="Email"><i class="fa-solid fa-at" aria-hidden="true"></i></a>
				<span class="tiny-vspace"></span>
				<a href="/feed.xml" aria-label="RSS feed"><i class="fa-solid fa-rss" aria-hidden="true"></i></a>
			</p>
			<p class="small">
				<a href="https://github.com/xiaoxiae/slama.dev" rel="noopener noreferrer">source code</a>
				<span class="half-visible vspace">Â·</span>
				<a href="/privacy-policy/">privacy policy</a>
				<span class="half-visible vspace">Â·</span>
			<a href="/security/">security</a>
			<span class="half-visible vspace">Â·</span>
    			<span>ðŸ‡¨ðŸ‡¿ ðŸ‡µðŸ‡¸ ðŸ‡ºðŸ‡¦</span>
			{{ if site.Params.halloween }}
			<span class="half-visible vspace">Â·</span>
			<button type="button" class="halloween-toggle-btn" onclick="toggleHalloween();" aria-label="Toggle Halloween theme">ðŸŽƒ<span class="halloween-toggle-indicator"></span></button>
			{{ end }}
			</p>
		</footer>

		{{ if site.Params.halloween }}
		<!-- Apply Halloween mappings after scripts are loaded -->
		<script>
			window.addEventListener('load', function() {
				applyNavbarNameMapping();
				applyAuthorNameMapping();
				applyFooterLinkMapping();
				updateGhostCursorVisibility();
			});
		</script>
		{{ end }}

		{{- if .Store.Get "hasLightbox" }}
		<!-- Lightbox (only included on pages with lightbox-enabled images) -->
		<div id="lightbox" class="lightbox no-invert" style="display: none;">
			<div class="lightbox-content">
				<span class="lightbox-close" style="display: none;">&times;</span>
				<div class="lightbox-loader"></div>
				<img id="lightbox-thumb" class="lightbox-thumbnail" src="" alt="Thumbnail">
				<img id="lightbox-img" src="" alt="Enlarged image" style="display: none;">
			</div>
		</div>
		<script src="{{ "/assets/js/lightbox.js" | absURL }}"></script>
		{{- end }}
	</body>
</html>
